##  IPV4

### IP编址

- 标识
    - 32位二进制表示 
    - 点分十进制表示

- IP地址

    - 网络号 NetID：高位
    - 主机号 HostID：低位

- IP子网 subnets

    - 具有相同网络号的网络
    - 不跨越路由器（第三及以上层网络设备）可以彼此物理连通
    
- 有类IP地址 以此2分分类

    - A类 = NetID 8位 + HostID 24位 最高位固定为0 （0.0.0.0~127.255.255.255）50%
    - B类 = NetID 16位 + HostID 16位 最高位固定为10 （128.0.0.0~191.255.255.255）25%
    - C类 = NetID 24位 + HostID 8位 最高位固定为110（192.0.0.0~223.255.255.255）12.5%
    - D类 最高位1110 多播地址，只能发不能收（224.0.0.0~239.255.255.255）6.25%
    - E类 最高位1111 科研（240.0.0.0~255.255.255.255）6.25%




- 特殊ip地址

    - 

### 子网划分

增加子网id

HostID -> SubID + HostID

子网掩码 NetID和SubID位为1，HostID位为0，用来区分SubID和HostID，路由转发

子网HostID全0和全1不可分配给主机用，全1广播地址，全0





### 以太网

以太网是一种局域网技术，除此之外还有别的通信技术

双绞线和光线都可以作为以太网的传输介质



冲突域？？？

总线

星形拓补



以太网 无连接（不握手） 不可靠（错了就扔掉）



- 带冲突检测的载波侦听多路访问 CSMA/CD协议



1. 开始- 如果线路空闲，则启动传输，否则跳转到第4步。
2. 发送- 如果检测到冲突，继续发送数据直到达到最小回报时间（min echo receive interval）以确保所有其他转发器和终端检测到冲突，而后跳转到第4步。
3. 成功传输- 向更高层的网络协议报告发送成功，退出传输模式。
4. 线路繁忙- 持续等待直到线路空闲。
5. 线路空闲- 在尚未达到最大尝试次数之前，每隔一段随机时间转到第1步重新尝试。
6. 超过最大尝试传输次数- 向更高层的网络协议报告发送失败，退出传输模式。



NIC从网络层接收数据报创建数据帧

监听信道 空闲就发送，忙就等待

发送数据帧，期间没有故障则认为数据发送成功，如果期间检测到其他节点发送数据就停止发送，发送堵塞信号jam signal

中止发送等待一定时间（按照二进制指数退避算法）重新发送



- 二进制指数退避算法

m = 重试次数

n = Max(m , 10)

K = random(0, 2^n-1)

T = K * 512字节发送时间





- 以太网报文

（前导码）+ 目标mac + 源mac + type + data + crc

type 用于表示上层协议类型

data最少46~1500字节

前导码用于同步

mac地址6个字节

crc校验 4个字节





### 交换机

链路层设备

链路层地址 mac

交换表 自学习 泛洪

当收到一个数据帧，看目标地址是否在交换表中，如果不在添加一次交换表向所有接口转发一次，

```
mac 接口 ttl
```





VLAN 虚拟局域网 Virtual Local Area Network





### 网络层

- 转发

    将分组从路由器的输入端口转移到合适的输出端口，需要转发表 ，ip > 输出链路

- 路由

    确定分组从源到目的经过的路径，需要路由算法





